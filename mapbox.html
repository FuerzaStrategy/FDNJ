<!DOCTYPE html>
	<html>
	<head>
	    <meta charset='utf-8' />
	    <title>GeoJSON Test</title>
	    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
	    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>
	    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet' />
	    <style>
	
	        :root {
	            --top-push: 50px;
	            --view-width: calc(50% - 10px);
	            --view-height: 500px;
	        }
	
	        body { 
	            margin: 0; 
	            padding: 0; 
	            font-family: Arial, 'sans-serif';
	            overflow-x: hidden;
		    background-image: url("./data/Background-tool.png");
		    background-repeat: no-repeat;
		    background-attachment: fixed;
		    background-position: center;
		    background-size: 100% 111%;
	        }
	
	        .map {
	            margin-top: 100px;
	            padding: 0;
	            width: var(--view-width);
	            height: var(--view-height);
	            display: inline-block;
	        }
	
	        #previous_header {
	            margin-top: 0;
	            margin-left: 5%;
	            display: inline-block;
	            float: left;
	            width: calc(var(--view-width) - 5%);
	            text-align: center;
	            font-weight: bold;
	            color: white;
	            line-height: 50px;
	            font-size: 24px;
	        }
	
	
	        #current_header {
	            margin-top: 0;
	            margin-right: 5%;
	            display: inline-block;
	            float: right;
	            width: calc(var(--view-width) - 5%);
	            text-align: center;
	            font-weight: bold;
	            color: white;
	            line-height: 50px;
	            font-size: 24px;
	        }
	
	        .form {
	            width: 90%;
	            margin-left: 5%;
	            margin-top: 15px;
	            margin-bottom: 15px;
	        }
	
	        .zipInput {
	            border: 0;
	            border-bottom: 1px solid black;
	            outline: 0;
	            width: 400px;
	            font-size: 18px;
	        }
	
	        .zipSubmit {
	            background: #87859f;
	            font-size: 15px;
	            color: white;
	            padding: 5px 10px 5px 10px;
	        }
	
	        .zipSubmit:hover {
	            cursor: pointer;
	            background: #7d7b94;
	        }
	
	        #errorMessage {
	            font-size: 18px;
	            padding-left: 5%;
	            margin-bottom: 15px;
	            line-height: 18px;
	            height:18px;
	            width:100%;
	        }
	
	        #map_curr {
	            float: right;
	        }
	
	        #map_prev {
	            float: left;
	        }
	
	        .maps {
	            width: 90%;
	            margin-left: 5%;
	        }
	
	        #previous_district_number {
	            display: inline-block;
	            width: 49%;
	            text-align: center;
	            margin-top: 0;
		    font-size: 18px;
	        }
	
	        #current_district_number {
	            display: inline-block;
	            width: 49%;
	            text-align: center;
	            margin-top: 0;
		    font-size: 18px;
	        }
	
	        .map_prev_info {
	            margin-left: 5%;
	            width: calc(var(--view-width) - 5%);
	            text-align: center;
	            float: left;
	            display: inline-block;
	            background: #384369;
	        }
	
	        .map_curr_info {
	            margin-right: 5%;
	            display: inline-block;
	            float: right;
	            width: calc(var(--view-width) - 5%);
	            text-align: center;
	            display: inline-block;
	            background: #fce2aa;
	        }
	
	        .info_title {
	            font-weight: bold;
	        }
                 
         #table_black {
             border-style: solid black; 
             background: black; 
             margin-left: 5%; 
             margin-right: 5%; 
             border-radius: 15px; 
             height: 200px; 
             padding: 10px;
             color: white;
         }
	        
         #table_white {
             border-style: solid white; 
             background: white; 
             margin-left: 5%; 
             margin-right: 5%; 
             border-radius: 15px; 
             height: 200px; 
             padding: 10px;
             color: black;
         }
         #table_gray {
            border-style:solid #c3c3c1; 
            background:#c3c3c1; 
            margin-left:5%; 
            margin-right:5%; 
            border-radius:15px; 
            height:200px; 
            padding:10px;'
         }    
         #newsearch {
            box-sizing: content-box; 
            position: absolute;
            left: 32%; 
            width: 500px;
            height: 50px;
            padding: 30px;
            border: 1px solid black;
            background: black;
            color: white;
        }
        #blue_top {
            border-style:solid #384369; 
            background:#384369;   
            height:70px; 
            padding:10px;
            text-align: center;
            color: white;
            font: arial;
         }          
         #yellow_top {
            border-style:solid #fce2aa; 
            background:#fce2aa;   
            height:70px; 
            padding:10px;
            text-align: center;
            font: arial;
         }    
	    </style>
	</head>
	<body>
	

	<div id='main_field'>
	    <form class='form' name="myform" action="javascript:handleIt(zip.value)">
         <div id="newsearch" align="center" style="color:#fce2aa;">Compare your districts!         
	        <input class='zipInput' name="zip" id="zip" type="text" placeholder="Enter your address here" style="background-color:#c3c3c1;"/>
	        <input class='zipSubmit' name="Submit"  type="submit" value="Search"/>
	    </form>
	    <div id='errorMessage'></div>
      </div>
	    <div style='width: 100%; height: 50px;'></div>
	    <div class='maps'>
	        <div class='map' id='map_prev'><div id='blue_top'><h1>2001 –2010 District Map</h1><p id='previous_district_number'>  </p></div></div>
	        <div class='map' id='map_curr'><div id='yellow_top'><h1>2011 –2020 District Map</h1><p id='current_district_number'>  </p></div></div>
	    </div>
	    <div>
	        <div class='map_prev_info'>
	            <p id='city_prev' style='border-style:solid #c3c3c1; background:#c3c3c1; margin-left:5%; margin-right:5%; border-radius:15px; height:20px; padding:10px;'>Your Town: </p>
      <p id='other_city_prev' style='border-style:solid #c3c3c1; background:#c3c3c1; margin-left:5%; margin-right:5%; border-radius:15px; height:200px; padding:10px;'>Other Towns in your District:</p><!--NEW-->
	            <!--<p class='info_title'>Voters</p>-->
           <div id='table_black'>
              <p id='population_prev'>###,### People (Town)</p>
              <center>
              <table style='border: 1px solid white;border-collapse: collapse;width:100%; text-align:center;'>
		       <colgroup>
			    <col style="width: 33%" />
			    <col style="width: 33%" />
			    <col style="width: 33%" />
		       </colgroup>
              <tr style='border: 1px solid white;'>
	            <td style='border: 1px solid white;'><p>Black or African American</p></td>
	            <td style='border: 1px solid white;'><p>Asian</p></td>
	            <td style='border: 1px solid white;'><p>Hispanic or Latino</p></td>
              </tr>
              <tr style='border: 1px solid white;'>
              <td style='border: 1px solid white;'><p id='african_prev'>##%</p></td>
	            <td style='border: 1px solid white;'><p id='asian_prev'>##%</p></td>
	            <td style='border: 1px solid white;'><p id='hispanic_prev'>##%</p></td>
              </tr>
              </table>
              </center>
           </div>
           <br>
          <div id='table_white'><!--NEW-->
	      <sup align="right"><font size="1">*voters may be part of multiple groups</sup>
              <p id='population_prev_num'>District Demographics:</p> 
              <center>
              <table style='border: 1px solid black;border-collapse: collapse;width:100%; text-align:center;'>
		       <colgroup>
			    <col style="width: 33%" />
			    <col style="width: 33%" />
			    <col style="width: 33%" />
		       </colgroup>
              <tr style='border: 1px solid black;'>
	            <td style='border: 1px solid black;'><p>Black or African American</p></td>
	            <td style='border: 1px solid black;'><p>Asian</p></td>
	            <td style='border: 1px solid black;'><p>Hispanic or Latino</p></td>
              </tr>
              <tr style='border: 1px solid black;'>
              <td style='border: 1px solid black;'><p id='african_num'>##%</p></td>
	            <td style='border: 1px solid black;'><p id='asian_num'>##%</p></td>
	            <td style='border: 1px solid black;'><p id='hispanic_num'>##%</p></td>
              </tr>
              </table>
              </center>
	       
           </div>
           <br>
			<div id='table_black'>
              <p id='voters_prev'>###,### Registered Voters (Town)</p>
              <center>
              <table style='border: 1px solid white;border-collapse: collapse;width:100%; text-align:center;'>
	            <tr style='border: 1px solid white;'>
              <td style='border: 1px solid white;'><p>Democratics</p></td>
	            <td style='border: 1px solid white;'><p>Republicans</p></td>
              </tr>
              <tr style='border: 1px solid white;'>
              <td style='border: 1px solid white;'><p id='democratic_prev'>###,###</p></td>
	            <td style='border: 1px solid white;'><p id='republican_prev'>###,###</p></td>
              </tr>
              </table>
              </center>
           </div>
           <br>
           <div id='table_white'><!--NEW-->
              <p id='voters_prev_num'>###,### Registered Voters (District)</p>
              <center>
              <table style='border: 1px solid black;border-collapse: collapse;width:100%; text-align:center;'>
	            <tr style='border: 1px solid black;'>
              <td style='border: 1px solid black;'><p>Democratics</p></td>
	            <td style='border: 1px solid black;'><p>Republicans</p></td>
              </tr>
              <tr style='border: 1px solid black;'>
              <td style='border: 1px solid black;'><p id='democratic_num'>###,###</p></td>
	            <td style='border: 1px solid black;'><p id='republican_num'>###,###</p></td>
              </tr>
              </table>
              </center>
           </div>
           <br>
	            <!--<p class='info_title'>Fiscal</p>
	            <p id='taxable_prev'>Per Capital Taxable Property Value:</p>-->
	        </div>
	        <div class='map_curr_info'>
	            <p id='city_curr'style='border-style:solid #c3c3c1; background:#c3c3c1; margin-left:5%; margin-right:5%; border-radius:15px; height:20px; padding:10px;'>Your Town:</p>
             <div id='table_gray'><!--NEW-->
              <center>          
              <table style='border: 1px solid #c3c3c1;border-collapse: collapse;width:100%; text-align:center;'>
              <tr>
              <td style='width:50%'>Towns Added in 2011:</td>
              <td>Towns Removed in 2011:</td>
              </tr>
              <tr>
              <td id="added" style='width:50%'><br></td>
              <td id="removed"></td>
              </tr>
              </table>
              </center>
             </div>
              <br>
	            <!--<p class='info_title'>Voters</p>-->
	            <!--<p class='info_title'>Census</p>-->
             <div id='table_black'>
	            <p id='population_curr'>###,### People (Town)</p>
              <center>
              <table style='border: 1px solid white;border-collapse: collapse;width:100%; text-align:center;'>
		      <colgroup>
			    <col style="width: 33%" />
			    <col style="width: 33%" />
			    <col style="width: 33%" />
		       </colgroup>
              <tr style='border: 1px solid white;'>
	            <td style='border: 1px solid white;'><p>Black or African American</p></td>
	            <td style='border: 1px solid white;'><p>Asian</p></td>
	            <td style='border: 1px solid white;'><p>Hispanic or Latino</p></td>
              </tr>
              <tr style='border: 1px solid white;'>
	            <td style='border: 1px solid white;'><p id='african_curr'>##%</p></td>
	            <td style='border: 1px solid white;'><p id='asian_curr'>##%</p></td>
	            <td style='border: 1px solid white;'><p id='hispanic_curr'>##%</p></td>
	            </tr>
              </table>
              </center>
              </div>
              <br>
              <div id='table_white'><!--NEW-->
	            <p id='population_curr_num'>District Demographics:</p>
              <center>
              <table style='border: 1px solid black;border-collapse: collapse; text-align:center;table-layout: auto;width: 100%;'>
		       <!--<colgroup>
			    <col style="width: 33%" />
			    <col style="width: 33%" />
			    <col style="width: 33%" />
		       </colgroup>-->
              <tr>
		    <td style='border: 1px solid black;'><p>Deviation</p></td>
		    <td style='border: 1px solid black;'><p>White</p></td>
	            <td style='border: 1px solid black;'><p>Black or African American</p></td>
	            <td style='border: 1px solid black;'><p>Asian</p></td>
	            <td style='border: 1px solid black;'><p>Hispanic or Latino</p></td>
              </tr>
              <tr>
		    <td style='border: 1px solid black;'><p id='deviation_curr_num'>##</p></td>
		    <td style='border: 1px solid black;'><p id='white_curr_num'>##%</p></td>
	            <td style='border: 1px solid black;'><p id='african_curr_num'>##%</p></td>
	            <td style='border: 1px solid black;'><p id='asian_curr_num'>##%</p></td>
	            <td style='border: 1px solid black;'><p id='hispanic_curr_num'>##%</p></td>
	            </tr>
              </table>
              </center>
              </div>
              <br>
			<div id='table_black'>
	            <p id='voters_curr'>###,### Registered Voters (Town)</p>
              <center>
              <table style='border: 1px solid white;border-collapse: collapse;width:100%; text-align:center;'>
	            <tr style='border: 1px solid white;'>
	            <td style='border: 1px solid white;'><p>Democratics</p></td>
	            <td style='border: 1px solid white;'><p>Republicans</p></td>
              </tr>
              <tr style='border: 1px solid white;'>
              <td style='border: 1px solid white;'><p id='democratic_curr'>###,###</p></td>
	            <td style='border: 1px solid white;'><p id='republican_curr'>###,###</p></td>
              </tr>
              </table>
              </center>
             </div>
             <br>
             <div id='table_white'><!--NEW-->
	            <p id='voters_curr_num'>###,### Registered Voters (District)</p>
              <center>
              <table style='border: 1px solid black;border-collapse: collapse;width:100%; text-align:center;'>
	            <tr style='border: 1px solid black;'>
	            <td style='border: 1px solid black;'><p>Democratics</p></td>
	            <td style='border: 1px solid black;'><p>Republicans</p></td>
              </tr>
              <tr style='border: 1px solid black;'>
              <td style='border: 1px solid black;'><p id='democratic_curr_num'>###,###</p></td>
	            <td style='border: 1px solid black;'><p id='republican_curr_num'>###,###</p></td>
              </tr>
              </table>
              </center>
             </div>
             <br>
              <!--<p class='info_title'>Fiscal</p>
	            <p id='taxable_curr'>Per Capital Taxable Property Value:</p>-->
	        </div>
	    </div>
	</div>
	

	

	<script>

		
	    var ZtC = {}
	    var ZtName = {}
	    var data_2000 = {}
	    var data_2010 = {}
	    var NJ_Zip = []
	    var LegislativeDataCurrent = {}
	    var LegislativeDataPast = {}
	    var old_n = 40;
	    var new_n = 40;
	    var LegislativeDataPast_Districts = {}
	    var LegislativeDataCurrent_Districts = {}
	    var currentHighlight_old = 0
	    var currentHighlight_new = 0
	    var polygons_old = Array(old_n).fill(0)
	    var polygons_new = Array(new_n).fill(0)
	    
	    var new_district_data = {}
	
	    $.getJSON("data/zip_to_coordinate.json", function(data) {
	        ZtC = data
	    })
	
	    $.getJSON("data/nj_zip_codes_to_towns.json", function(data) {
	        ZtName = data
	    })
	
	    $.getJSON("data/2000_data.json", function(data) {
	        data_2000 = data
	    })
	
	    $.getJSON("data/2010_data.json", function(data) {
	        data_2010 = data
	    })
	
	    $.getJSON("data/nj_zip_codes.json", function(data) {
	        NJ_Zip = data["zips"]
	    })
	
	    $.getJSON("data/2010_data_districts.json", function(data) { 
		new_district_data = data
	    })
	    
	   $.getJSON("data/2000_data_districts.json", function(data) { 
		old_district_data = data
	    })
		
	
	    function handleIt(zip) {
	
	        const Http = new XMLHttpRequest();
	        var replaced_zip = zip.split(' ').join('+');
	        var url='https://maps.googleapis.com/maps/api/geocode/json?address=' + replaced_zip + '&key=AIzaSyB-OrotjsC4Vwn-WVfJD7JeeVbMS1eyKOE';
	        Http.open("GET", url);
	        Http.send();
	
	        //Http.onreadystatechange = (e) => {
	            Http.onreadystatechange = function(){ 
			  if (this.readyState == 4 && this.status == 200) {
		    var data = JSON.parse(this.responseText)
		    }
	
	            if(data.results[0] === undefined) {
	
	                $("#errorMessage").text("Please Enter a Valid Address in New Jersey");
	            }
	
	            else {
	                var lat = parseFloat(data.results[0].geometry.location.lat)
	                var lon = parseFloat(data.results[0].geometry.location.lng)
	
	                var townName;
	                var data_from_2000;
	                var data_from_2010;
	                var address_components = data.results[0].address_components
	                for(var i = 0; i < address_components.length; i ++) {
	                    var townName_temp = address_components[i].long_name
	                    if(data_2000[townName_temp] !== undefined) {
	                        townName = townName_temp
	                        data_from_2000 = data_2000[townName]
	                        data_from_2010 = data_2010[townName]
	                    }
	                }
	                
			
			    
	                map_origin = [lon, lat]
	
	                map_prev.flyTo({
	                    center: map_origin,
	                    zoom: map_scale
	                });
	
	                map_curr.flyTo({
	                    center: map_origin,
	                    zoom: map_scale
	                });
	
	                var relatedFeatures = map_prev.querySourceFeatures('route', {
	                    sourceLayer: 'route-layer',
	                    filter: ["==", 'type', 'Feature']
	                });
	
	                var point = turf.point([lon, lat]);
	                var old_index = 0;
	                for(var i = 1; i <= old_n; i++) {
	                    if(polygons_old[i] != 0) {
	                        for(var k = 0; k < polygons_old[i].length; k++) {
	                            var test = turf.inside(point, polygons_old[i][k]);
	                            if(test)
	                                old_index = i
	                        }
	                    }
	                }
	                var new_index = 0;
	                for(var i = 1; i <= new_n; i++) {
	                    if(polygons_new[i] != 0) {
	                        for(var l = 0; l < polygons_new[i].length; l++) {
	                            var test = turf.inside(point, polygons_new[i][l]);
	                            if(test)
	                                new_index = i
	                        }
	                    }
	                }
	
	
	                if(currentHighlight_old > 0)
	                    map_prev.setPaintProperty('route-fills-' + currentHighlight_old.toString(), 'fill-opacity', 0.15);
	                if(currentHighlight_new > 0)
	                    map_curr.setPaintProperty('route-fills-' + currentHighlight_new.toString(), 'fill-opacity', 0.15);
	                currentHighlight_old = old_index
	                currentHighlight_new = new_index
			var file_name = "District " + currentHighlight_new.toString()
			    
			 //console.log(currentHighlight_new)
			 //console.log(file_name)
			  
			// console.log(old_district_data[file_name]['Name'])
			 var make_old_array = (old_district_data[file_name]['Name']).split(",")
			 var make_array = (new_district_data[file_name]['Name']).split(",")
			 //console.log(make_old_array)
			 //console.log(new_district_data[file_name]['Deviation'])
			    
			var list_towns = []
			var uniqueNames = [];
			var final_old_array = [];
			var district_african_old = [];
			var district_asian_old = [];
			var district_hispanic_old = [];
			var old_african_num;
			var old_asian_num;
			var old_hispanic_num;
			var district_dem_num = [];
			var district_rep_num = [];
			var district_old_people = [];
			var district_old_voters = [];
			var final_old_array_show = [];
			var looking_names = JSON.stringify(data_2000);
			//$.getJSON("data/NJ_Legislative_Old/District_" + currentHighlight_old.toString() + ".geojson", function(json_coor){
			//for(var i=0; i<json_coor["features"][0]["geometry"]["coordinates"][0].length; i++){
			//var lons = json_coor["features"][0]["geometry"]["coordinates"][0][i][0]
			//var lats = json_coor["features"][0]["geometry"]["coordinates"][0][i][1]
			//var urls='https://maps.googleapis.com/maps/api/geocode/json?address=' + lats + ',' + lons + '&key=AIzaSyB-OrotjsC4Vwn-WVfJD7JeeVbMS1eyKOE';
			//const Http = new XMLHttpRequest();
				
				
	        	//Http.onreadystatechange = function() {
			 // if (this.readyState == 4 && this.status == 200) {
			  //   var data_need = JSON.parse(this.responseText);
			  //   var address_name =data_need.results[0].formatted_address.split(",")[1] 
			//	var correct_address_name = address_name.slice(1,address_name.length)
			//     var other_townName_temp = correct_address_name
			
			 //    list_towns.push(other_townName_temp);
			 //    $.each(list_towns, function(i, el){
			 //   if($.inArray(el, uniqueNames) === -1) uniqueNames.push(el);
			//	});
						
			//  }
				
			//}
			//Http.open("GET", urls) 
	      		//Http.send()


				
			//   		 }

				
			//	});
				 
			       	 		       
			       
	  		 Array.prototype.remove = function() {
			    var what, a = arguments, L = a.length, ax;
			    while (L && this.length) {
				what = a[--L];
				while ((ax = this.indexOf(what)) !== -1) {
				    this.splice(ax, 1);
				}
			    }
			    return this;
			};
 				
			      
			      
			var list_towns_current = []
			var uniqueNames_current = [];
			var final_array_current = [];
			var district_african_current = [];
			var district_asian_current = [];
			var district_hispanic_current = [];
			var african_num_current;
			var asian_num_current;
			var hispanic_num_current;
			var district_dem_num_current = [];
			var district_rep_num_current = [];
			var district_people_current = [];
			var district_voters_current = [];
			var final_array_show_current = [];
			var looking_names = JSON.stringify(data_2010);
			var looking_names_old = JSON.stringify(data_2000);
			//$.getJSON("data/NJ_Legislative/District_" + currentHighlight_new.toString() + ".geojson", function(json_coor_current){
			//	for(var i=0; i<json_coor_current["features"][0]["geometry"]["coordinates"][0].length; i++){
			//var lons_current = json_coor_current["features"][0]["geometry"]["coordinates"][0][i][0]
			//var lats_current = json_coor_current["features"][0]["geometry"]["coordinates"][0][i][1]
			//console.log(lats_current)
			//var urls_current='https://maps.googleapis.com/maps/api/geocode/json?address=' + lats_current + ',' + lons_current + '&key=AIzaSyB-OrotjsC4Vwn-WVfJD7JeeVbMS1eyKOE';
			//console.log(urls_current)
			//const Http_current = new XMLHttpRequest();
		
				
	        	//Http_current.onreadystatechange = function() {
			//  if (this.readyState == 4 && this.status == 200) {
			//     var data_need_current = JSON.parse(this.responseText);
			 //    var address_name_current =data_need_current.results[0].formatted_address.split(",")[1] 
			//	var correct_address_name_current = address_name_current.slice(1,address_name_current.length)
			//     var other_townName_current = correct_address_name_current
			
			//     list_towns_current.push(other_townName_current);
			  //  $.each(list_towns_current, function(i, el){
			  // if($.inArray(el, uniqueNames_current) === -1) uniqueNames_current.push(el);
			//	});
						
			//  }
				
			//}
			//Http_current.open("GET", urls_current) 
	      		//Http_current.send()
				
			   		 }
				    //console.log(list_towns_current)
			//	});
			    
			    var array_removed = []
			    var array_added = []
			    var array_final_added = []
			    var final_new_array = []
			    var rep_ratio_current = []
			    var dem_ratio_current = []
			    var african_ratio_current =[]
			    var asian_ratio_current = []
			    var hispanic_ratio_current = []
			    var rep_ratio_old = []
			    var dem_ratio_old = []
			    var african_ratio_old =[]
			    var asian_ratio_old = []
			    var hispanic_ratio_old = []
			    //var show_array = []
			    
			    make_old_array.forEach(function(a, ind){
				if(looking_names_old.includes(make_old_array[ind])){
				final_old_array.push(make_old_array[ind])
			       }
			      });
			    
			  
			    
	                    make_old_array.forEach(function(a, ind){
				if(looking_names_old.includes(make_old_array[ind])){
				final_old_array_show.push(make_old_array[ind])
			       }
			    });
			    
			    final_old_array_show = final_old_array_show.filter(e => e !== townName)
			    var show_array= final_old_array_show.join(', ')
					     
							     
				final_old_array.forEach(function(a,ind){
				district_african_old.push(Number(data_2000[a]['african']))
				district_asian_old.push(Number(data_2000[a]['asian']))
				district_hispanic_old.push(Number(data_2000[a]['hispanic']))
			        district_dem_num.push(Number(data_2000[a]['democratic']))
				district_rep_num.push(Number(data_2000[a]['republican']))
				district_old_people.push(Number(parseFloat((data_2000[a]['population']).replace(/,/g, ''))))
				district_old_voters.push(Number(parseFloat((data_2000[a]['voters']).replace(/,/g, ''))))
				});
			    
			         
			    	    for(var i=0; i<district_old_people.length; i++){
				    rep_ratio_old.push(district_old_people[i]*(district_rep_num[i]/100))
				    dem_ratio_old.push(district_old_people[i]*(district_dem_num[i]/100))
				    african_ratio_old.push(district_old_people[i]*(district_african_old[i]/100))
				    asian_ratio_old.push(district_old_people[i]*(district_asian_old[i]/100))
				    hispanic_ratio_old.push(district_old_people[i]*(district_hispanic_old[i]/100))
			   	    }
			    
				 //if(final_old_array.includes(townName)){
				  //  var final_old_array_show = final_old_array.remove(townName);
				  //  }
				//console.log(final_old_array_show)
				//console.log(final_old_array)
			    
			    
			    make_array.forEach(function(a, ind){
				if(looking_names.includes(make_array[ind])){
				final_new_array.push(make_array[ind])
			       }
			      });
			    
			      final_new_array.forEach(function(a,ind){
			                district_african_current.push(Number(data_2010[a]['african']))
					district_asian_current.push(Number(data_2010[a]['asian']))
					district_hispanic_current.push(Number(data_2010[a]['hispanic']))
					district_dem_num_current.push(Number(data_2010[a]['democratic']))
					district_rep_num_current.push(Number(data_2010[a]['republican']))
					district_people_current.push(Number(parseFloat((data_2010[a]['population']).replace(/,/g, ''))))
					district_voters_current.push(Number(parseFloat((data_2010[a]['voters']).replace(/,/g, ''))))
					});
				
			    console.log(district_people_current)
			    for(var i=0; i<district_people_current.length; i++){
				    rep_ratio_current.push(district_people_current[i]*(district_rep_num_current[i]/100))
				    dem_ratio_current.push(district_people_current[i]*(district_dem_num_current[i]/100))
				    african_ratio_current.push(district_people_current[i]*(district_african_current[i]/100))
				    asian_ratio_current.push(district_people_current[i]*(district_asian_current[i]/100))
				    hispanic_ratio_current.push(district_people_current[i]*(district_hispanic_current[i]/100))
			    }
			    
			    
			    
			 
			    
	                if(data_from_2000 == undefined) {
	                    $('#city_prev').text("Your Town: " + townName)
	                    $('#voters_prev').text("N/A Registered Voters (Town)")
	                    $('#democratic_prev').text("N/A %")
	                    $('#republican_prev').text("N/A %")
	                    $('#population_prev').text("N/A People (Town)")
	                    $('#african_prev').text("N/A %")
	                    $('#asian_prev').text("N/A %")
	                    $('#hispanic_prev').text("N/A %")
	                    $('#taxable_prev').text("Per Capital Taxable Property Value: N/A")
	                }
	
	                else {
	                    $('#city_prev').html("Your Town: " + townName)
			    // setTimeout(function(){
			         //console.log(uniqueNames)
			         
				
				
			      $('#other_city_prev').html("Other Towns in your District: <br><br>" + show_array)
			      $('#african_num').text((((african_ratio_old.reduce((a, b) => a + b, 0)/ district_old_people.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#asian_num').text((((asian_ratio_old.reduce((a, b) => a + b, 0)/ district_old_people.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#hispanic_num').text((((hispanic_ratio_old.reduce((a, b) => a + b, 0)/ district_old_people.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#democratic_num').text((((dem_ratio_old.reduce((a, b) => a + b, 0)/ district_old_people.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#republican_num').text((((rep_ratio_old.reduce((a, b) => a + b, 0)/ district_old_people.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#population_prev_num').html("District Demographics:<br>" +(district_old_people.reduce((a, b) => a + b, 0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " Total Population")
			      $('#voters_prev_num').text((district_old_voters.reduce((a, b) => a + b, 0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")  + " Registered Voters (District)")
			      //}, 10000);

	                    $('#voters_prev').text(data_from_2000['voters'] + " Registered Voters (Town)")
	                    $('#democratic_prev').text(data_from_2000['democratic'] + "%")
	                    $('#republican_prev').text(data_from_2000['republican'] + "%")
	                    $('#population_prev').text(data_from_2000['population'] + " People (Town)")
	                    $('#african_prev').text(data_from_2000['african'] + "%")
	                    $('#asian_prev').text(data_from_2000['asian'] + "%")
	                    $('#hispanic_prev').text(data_from_2000['hispanic'] + "%")
	                    $('#taxable_prev').text("Per Capital Taxable Property Value: $" + data_from_2000['taxable'])
	                }
	
	                if(data_from_2010 == undefined) {
	                    $('#city_curr').text("Your Town: " + townName)
	                    $('#voters_curr').text("N/A Registered Voters (Town)")
	                    $('#democratic_curr').text("N/A %")
	                    $('#republican_curr').text("N/A %")
	                    $('#population_curr').text("N/A People (Town)")
	                    $('#african_curr').text("N/A %")
	                    $('#asian_curr').text("N/A %")
	                    $('#hispanic_curr').text("N/A %")
	                    $('#taxable_curr').text("Per Capital Taxable Property Value: N/A")
	                }
			    
			    
	
	                else {
	                    $('#city_curr').text("Your Town: " + townName)
			    //setTimeout(function(){
				  
				    
				    
				    
				    for(var i=0; i<make_array.length; i++){
				if(final_old_array.includes(make_array[i])){
					//array_removed.push(final_old_array[i])
					continue;
				}
				  else {
					  array_added.push(make_array[i])
					  //array_added.push(", ")
				  }
			    }
				    
				 
				 for(var i=0; i<final_old_array.length; i++){
					if(make_array.includes(final_old_array[i])){
						//array_final_added.push(make_array[i])
						continue;
					}
					 else{
						 array_removed.push(final_old_array[i])
						 
					 }
				 }
				//console.log(array_final_added)
				//console.log(array_removed)
			    	//console.log(array_added)
				    
				    console.log(make_array)
				console.log(final_old_array)
				console.log(array_removed)
				    
				    
			      //$('#african_curr_num').text((((african_ratio_current.reduce((a, b) => a + b, 0)/ district_people_current.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      //$('#asian_curr_num').text((((asian_ratio_current.reduce((a, b) => a + b, 0)/ district_people_current.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      //$('#hispanic_curr_num').text((((hispanic_ratio_current.reduce((a, b) => a + b, 0)/ district_people_current.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#deviation_curr_num').text(new_district_data[file_name]['Deviation'])	
			      $('#white_curr_num').text(new_district_data[file_name]['white'] + "%")
			      $('#african_curr_num').text(new_district_data[file_name]['african'] + "%")
			      $('#asian_curr_num').text(new_district_data[file_name]['asian'] + "%")
			      $('#hispanic_curr_num').text(new_district_data[file_name]['hispanic'] + "%")
			      $('#democratic_curr_num').text((((dem_ratio_current.reduce((a, b) => a + b, 0)/ district_people_current.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#republican_curr_num').text((((rep_ratio_current.reduce((a, b) => a + b, 0)/ district_people_current.reduce((a, b) => a + b, 0)))*100).toFixed(2) + "%")
			      $('#population_curr_num').html("District Demographics:<br>" + (district_people_current.reduce((a, b) => a + b, 0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " Total Population")
			      $('#voters_curr_num').text((district_voters_current.reduce((a, b) => a + b, 0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")  + " Registered Voters (District)")
			      $('#added').html("<br>" + (array_added).join(', '))
			      $('#removed').html("<br>" + (array_removed).join(', '))
			      //}, 20000);
				  
	                    $('#voters_curr').text(data_from_2010['voters'] + " Registered Voters (Town)")
	                    $('#democratic_curr').text(data_from_2010['democratic'] + "%")
	                    $('#republican_curr').text(data_from_2010['republican'] + "%")
	                    $('#population_curr').text(data_from_2010['population'] + " People (Town)")
	                    $('#african_curr').text(data_from_2010['african'] + "%")
	                    $('#asian_curr').text(data_from_2010['asian'] + "%")
	                    $('#hispanic_curr').text(data_from_2010['hispanic'] + "%")
	                    $('#taxable_curr').text("Per Capital Taxable Property Value: $" + data_from_2010['taxable'])
	                }
	
	                $('#previous_district_number').text("Legislative District " + old_index.toString())
	                $('#current_district_number').text("Legislative District " + new_index.toString())
	
	                map_prev.setPaintProperty('route-fills-' + old_index.toString(), 'fill-opacity', 0.5);
	                map_curr.setPaintProperty('route-fills-' + new_index.toString(), 'fill-opacity', 0.5);
	            }
	        }
	    //}
	
	
	    $.getJSON("data/NJ_Legislative.geojson", function(json) {
	        LegislativeDataCurrent = json
	    });
	
	    $.getJSON("data/NJ_Legislative_Old.geojson", function(json) {
	        LegislativeDataPast = json
	    });
	
	    for(var i = 1; i <= old_n; i++) {
	        $.getJSON("data/NJ_Legislative_Old/District_" + i.toString() + ".geojson", function(json_old) {
	            var id = json_old["features"][0]["properties"]["ID"]
	            LegislativeDataPast_Districts[id] = json_old
	            var coordinates = json_old["features"][0]["geometry"]["coordinates"]
	            var polygons_group = []
	            if(coordinates.length == 1 || id == "31") {
	                polygons_group.push( turf.polygon( coordinates, { name: 'poly1'} ))
	                polygons_old[parseInt(id)] = polygons_group
	            }
	            else {
	
	                for(var k = 0; k < coordinates.length; k++) {
	                    polygons_group.push( turf.polygon( coordinates[k], { name: 'poly1'} ) )
	                }
	                polygons_old[parseInt(id)] = polygons_group
	                
	            }
	        });
	    }
	
	    
	    for(var j = 1; j <= new_n; j++) {
	        $.getJSON("data/NJ_Legislative/District_" + j.toString() + ".geojson", function(json_new) {
	            var object_id = json_new["features"][0]["properties"]["OBJECTID"]
	            LegislativeDataCurrent_Districts[object_id.toString()] = json_new
	            var coordinatesNew = json_new["features"][0]["geometry"]["coordinates"]
	            var polygons_group = []
	            
	            if(coordinatesNew.length == 1 || object_id == "34") {
	                polygons_group.push( turf.polygon( coordinatesNew, { name: 'poly1'} ))
	                polygons_new[object_id] = polygons_group
	            }
	            else {
	
	                for(var l = 0; l < coordinatesNew.length; l++) {
	                    polygons_group.push( turf.polygon( coordinatesNew[l], { name: 'poly1'} ) )
	                }
	                polygons_new[object_id] = polygons_group
	                
	            }
	        });
	    } 
	
		
	    
	    mapboxgl.accessToken = 'pk.eyJ1IjoiZnVlcnphc3RyYXRlZ3lncm91cCIsImEiOiJjanoycWJqcHkwNnA4M2pudHFmdnJ5bXZlIn0.eaNrVgK5M7eLrCmi_hGX1A';
	
	    map_origin = [-74.53734351262877, 40.137451890638886]
	    map_scale = 6.3
	
	
	    var map_prev = new mapboxgl.Map({
	        container: 'map_prev',
	        style: 'mapbox://styles/mapbox/streets-v11',
	        center: map_origin,
	        zoom: map_scale
	    });
		
	
	    map_prev.on('load', function () {
	
	        map_prev.addSource('route', {
	          type: 'geojson',
	          data: LegislativeDataPast
	        });
	
	
	        for(var i = 1; i <= old_n; i++) {
	            i_str = i.toString()
	            map_prev.addSource('route_old_' + i_str, {
	              type: 'geojson',
	              data: LegislativeDataPast_Districts[i_str]
	            });
	
	        }
	        
	
	        map_prev.addLayer({
	            "id": "route",
	            "type": "line",
	            "source": "route",
	            "sourcelayer": "route-layer",
	            "layout": {
	                "line-join": "round",
	                "line-cap": "round"
	            },
	            "paint": {
	                "line-color": "#888",
	                "line-width": 1
	            }
	        });
	
	        for(var i = 1; i <= old_n; i++) {
	            map_prev.addLayer({
	                "id": "route-fills-" + i.toString(),
	                "type": "fill",
	                "source": "route_old_" + i.toString(),
	                "layout": {},
	                "paint": {
	                    "fill-color": "#627BC1",
	                    "fill-opacity": 0.15
	                }
	            });
	
	        }
	
	
	
	
	    });
	
	
	    var map_curr = new mapboxgl.Map({
	        container: 'map_curr',
	        style: 'mapbox://styles/mapbox/streets-v11',
	        center: map_origin,
	        zoom: map_scale
	    });
	
	    map_curr.on('load', function () {
	
	        map_curr.addSource('route', {
	          type: 'geojson',
	          data: LegislativeDataCurrent
	        });
	
	        
	        for(var j = 1; j <= new_n; j++) {
	            j_str = j.toString()
	            map_curr.addSource('route_new_' + j_str, {
	              type: 'geojson',
	              data: LegislativeDataCurrent_Districts[j_str]
	            });
	
	        }
	        
	
	        map_curr.addLayer({
	            "id": "route",
	            "type": "line",
	            "source": "route",
	            "layout": {
	                "line-join": "round",
	                "line-cap": "round"
	            },
	            "paint": {
	                "line-color": "#888",
	                "line-width": 1
	            }
	        });
	
	        
	        for(var j = 1; j <= new_n; j++) {
	            map_curr.addLayer({
	                "id": "route-fills-" + j.toString(),
	                "type": "fill",
	                "source": "route_new_" + j.toString(),
	                "layout": {},
	                "paint": {
	                    "fill-color": "#627BC1",
	                    "fill-opacity": 0.15
	                }
	            });
	
	        } 
	
	    });
	
	
	
	    //------------------ Align Maps To Same Centers/Zoom -----------------//
	
	    var disable = false;
	  
	  map_prev.on('move', function () {
	        if (!disable) {
	            map_origin = map_prev.getCenter()
	            map_scale = map_prev.getZoom()
	            disable = true;
	            map_curr.setCenter(map_origin)
	            map_curr.setZoom(map_scale)
	            disable = false;
	        }
	    })
	    
	    map_prev.on('zoom', function () {
	        if (!disable) {
	            map_origin = map_prev.getCenter()
	            map_scale = map_prev.getZoom()
	            disable = true;
	            //map_curr.setCenter(map_origin)
	            //map_curr.setZoom(map_scale)
	            //disable = false;
	        }
	    })
	
	    map_curr.on('move', function () {
	        if (!disable) {
	            map_origin = map_curr.getCenter()
	            map_scale = map_curr.getZoom()
	            disable = true;
	            map_prev.setCenter(map_origin)
	            map_prev.setZoom(map_scale)
	            disable = false;
	        }
	    })
	
	    map_curr.on('zoom', function () {
	        if (!disable) {
	            map_origin = map_curr.getCenter()
	            map_scale = map_curr.getZoom()
	            disable = true;
	            //map_prev.setCenter(map_origin)
	            //map_prev.setZoom(map_scale)
	            //disable = false;
	        }
	    }) 
		
		map_prev.addControl(new mapboxgl.NavigationControl());
		map_curr.addControl(new mapboxgl.NavigationControl());	
	
	</script>

	</body>
	</html>

